## Problem
Crear **Chromatic Quest**, un juego web de pintar por números con temática de fantasía/magia, donde las imágenes se generan dinámicamente usando Gemini API y se convierten automáticamente a formato "paint by numbers".

## Essential Information

### Decisiones del Usuario
- **Plataforma**: Web (navegador)
- **Generación de imágenes**: Gemini API (Nano Banana / Nano Banana Pro)
- **Mecánica**: Con desafíos (contrarreloj, precisión, niveles progresivos)
- **Persistencia**: LocalStorage (sin backend)
- **API Key**: El usuario ya tiene una API key de Gemini configurada
- **Nombre del juego**: Chromatic Quest

### Stack Técnico
- React 19.x + TypeScript 5.x
- Vite 7.x como bundler
- Tailwind CSS 4.x para estilos
- HTML5 Canvas API para renderizado
- @google/genai SDK para Gemini API

### Fase 1 Completada: Núcleo del Juego
**Archivos:**
- `src/types/index.ts` - Tipos TypeScript
- `src/utils/colorQuantizer.ts` - K-means clustering con espacio LAB
- `src/utils/regionDetector.ts` - Flood-fill, detección de regiones
- `src/hooks/useCanvas.ts` - Hook para manejo del canvas
- `src/components/Canvas/GameCanvas.tsx` - Componente de canvas interactivo
- `src/components/ColorPalette/ColorPalette.tsx` - Paleta de colores numerada
- `src/App.tsx` - Integración completa con UI

### Fase 2 Completada: Integración Gemini API
**Archivos creados:**
- `src/services/gemini.ts` - Cliente Gemini con retry y exponential backoff
- `src/services/imageProcessor.ts` - Pipeline: base64 → ImageData → PaintByNumbers
- `src/services/storage.ts` - Caché en localStorage
- `src/config/prompts.ts` - Prompts por categoría
- `src/hooks/useImageGeneration.ts` - Hook para generación de imágenes
- `.env.example` - Ejemplo de configuración de API key

### Fase 3 Completada: Sistema de Juego
**Archivos creados:**
- `src/services/scoring.ts` - Cálculo de puntuación, combos, estrellas
- `src/hooks/useTimer.ts` - Timer con pause/resume, penalización, visibilidad
- `src/hooks/useGameState.ts` - Estado del juego con useReducer
- `src/components/Timer/Timer.tsx` - Display MM:SS con colores críticos
- `src/components/ScoreBoard/ScoreBoard.tsx` - Puntuación en vivo, combo, accuracy
- `src/components/GameOverModal/GameOverModal.tsx` - Modal con estrellas y desglose

**Funcionalidades Fase 3:**
- 3 Modos de juego: Combined, Timed, Precision
- Timer con countdown, pause/resume, penalización -5s por error
- Sistema de combos: x1 (1-2), x1.5 (3-5), x2 (6-9), x3 (10+)
- Puntuación: Base + time bonus + accuracy bonus + combo
- Estrellas: 3 (>95%), 2 (>75%), 1 (>50%)

### Fase 4 Completada: Niveles y Progresión
**Archivos creados:**
- `src/services/levelConfig.ts` - Configuración de 4 mundos × 5 niveles = 20 niveles
- `src/hooks/useProgress.ts` - Hook para gestionar progreso del jugador
- `src/components/LevelSelector/WorldCard.tsx` - Tarjeta de mundo
- `src/components/LevelSelector/LevelButton.tsx` - Botón de nivel con estrellas
- `src/components/LevelSelector/LevelSelector.tsx` - Selector de mundos y niveles
- `src/components/ProgressBar/ProgressBar.tsx` - Barra de progreso
- `src/components/UnlockModal/UnlockModal.tsx` - Modal de desbloqueo con confetti

**Archivos modificados:**
- `src/types/index.ts` - +LevelDifficulty, LevelResult, Level, World, PlayerProgress
- `src/services/storage.ts` - +funciones de persistencia de progreso
- `src/App.tsx` - Flujo levels→menu→playing, integración de progreso

**Funcionalidades Fase 4:**
- 4 mundos: Criaturas Mágicas, Paisajes Fantásticos, Objetos Mágicos, Personajes
- 5 niveles por mundo (20 niveles total)
- Dificultad progresiva: 5-20 colores, 15-160 regiones, 5:00-2:00 tiempo
- Desbloqueo: completar nivel N desbloquea N+1
- 10 estrellas en un mundo desbloquean el siguiente mundo
- Persistencia de progreso en localStorage
- UI: selector de mundos/niveles, indicadores de estrellas, modal de desbloqueo

### Estado del Build
- Build exitoso sin errores
- Lint pasando sin warnings
- Dev server: http://localhost:5173/

### Fases del Proyecto (beads)
| ID | Fase | Estado |
|-----|------|--------|
| `lores-land-1am` | Fase 1: Núcleo del Juego | Closed |
| `lores-land-e9d` | Fase 2: Integración Gemini | Closed |
| `lores-land-p1a` | Fase 3: Sistema de Juego | Closed |
| `lores-land-c8k` | Fase 4: Niveles y Progresión | Closed |
| `lores-land-dql` | Fase 5: UX y Polish | Ready |

### Reglas del Usuario
- **No tocar archivos de checkpoint** (prohibido modificarlos o crearlos por cuenta propia)
- **Esperar validación del usuario** después de completar cada fase antes de continuar
- **No hacer commits** sin aprobación del usuario

### Proyecto
- Ruta: `/Users/mabrax/Documents/playground/lores-land/chromatic-quest/`
